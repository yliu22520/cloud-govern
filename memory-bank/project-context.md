# 项目上下文文档 - Cloud Govern

> 版本: 1.0 | 创建日期: 2026-02-13 | 状态: 规划阶段

---

## 一、项目概要（Project Overview）

### 项目名称
**Cloud Govern** - 轻量级微服务治理平台

### 项目背景
随着微服务架构的普及，Spring Cloud 生态成为 Java 微服务开发的主流选择。然而，现有的治理工具（如 Nacos Console、Sentinel Dashboard）分散独立，缺乏统一的管理界面，运维成本高。本项目旨在提供一个统一、易用的微服务治理平台。

### 目标与目的
- **主要目标**：构建一个统一的微服务治理平台，集成 Nacos、Sentinel、Gateway 等核心组件
- **学习目的**：深入理解 Spring Cloud 微服务架构、前后端分离开发、开源项目管理
- **开源目的**：经过迭代后对外开源，为社区提供有价值的工具

### 要解决的问题
1. 现有治理工具分散，需要多个控制台切换
2. 操作体验不统一，学习成本高
3. 缺乏统一权限管理和审计能力
4. 中小团队难以快速搭建微服务治理体系

### 整体愿景
成为 Spring Cloud 微服务治理的统一控制台，提供一站式服务管理、配置管理、监控告警、网关管理能力。

---

## 二、范围定义（Scope Definition）

### 当前范围（MVP 阶段）

| 模块 | 功能点 | 优先级 |
|------|--------|--------|
| 服务注册管理 | 服务列表、服务详情、实例管理、健康状态 | P0 |
| 配置中心管理 | 命名空间管理、配置列表、配置编辑、历史版本 | P0 |
| 服务监控 | 服务健康检查、基础指标、告警规则 | P0 |
| 用户管理 | 用户登录、角色权限、菜单管理 | P0 |
| API 网关管理 | 路由规则、限流配置、服务过滤 | P1 |

### 非本次范围
- ❌ 应用托管与部署（类似 Heroku）
- ❌ CI/CD 流水线集成
- ❌ 容器编排（K8s）管理
- ❌ 分布式链路追踪（SkyWalking/Zipkin）
- ❌ 计费系统

### 约束条件
- 后端必须基于 Spring Cloud Alibaba 技术栈
- 前端必须使用 Vue 3 + TDesign
- MVP 阶段不依赖 K8s，支持 Docker Compose 部署
- 核心功能需要对接 Nacos/Sentinel 现有 API

---

## 三、关键实体与关系（Key Entities & Relationships）

### 核心实体

```
┌─────────────────────────────────────────────────────────────┐
│                        Cloud Govern                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐  │
│  │  User   │───▶│  Role   │───▶│  Menu   │    │ Audit   │  │
│  │ 用户    │    │ 角色    │    │ 菜单    │    │ 日志    │  │
│  └─────────┘    └─────────┘    └─────────┘    └─────────┘  │
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │  Namespace  │  │   Config    │  │   Service   │         │
│  │  命名空间    │  │   配置      │  │   服务      │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
│                         │                  │                │
│                         ▼                  ▼                │
│                  ┌─────────────┐  ┌─────────────┐         │
│                  │ConfigHistory│  │  Instance   │         │
│                  │ 配置历史    │  │   实例      │         │
│                  └─────────────┘  └─────────────┘         │
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │   Route     │  │   Rule      │  │   Alert     │         │
│  │ 网关路由    │  │ 限流规则    │  │   告警      │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 实体职责

| 实体 | 职责说明 |
|------|----------|
| User | 系统用户，包含登录凭证、基本信息 |
| Role | 角色定义，关联权限集合 |
| Menu | 菜单资源，控制前端路由和按钮权限 |
| AuditLog | 操作审计日志，记录用户行为 |
| Namespace | Nacos 命名空间，配置和服务隔离单元 |
| Config | 配置项，属于某个命名空间 |
| ConfigHistory | 配置变更历史，支持回滚 |
| Service | 注册的服务实例集合 |
| Instance | 具体的服务实例，包含 IP、端口、状态 |
| Route | API 网关路由规则 |
| Rule | 限流、熔断规则（Sentinel） |
| Alert | 告警规则和告警记录 |

### 实体关系描述
- User 与 Role 是多对多关系
- Role 与 Menu 是多对多关系
- Namespace 包含多个 Config 和 Service
- Service 包含多个 Instance
- Config 有多个 ConfigHistory 记录

---

## 四、功能模块拆解（Functional Decomposition）

### 模块列表

```
cloud-govern/
├── cloud-govern-gateway      # API 网关服务
├── cloud-govern-auth         # 认证授权服务
├── cloud-govern-system       # 系统管理服务
├── cloud-govern-registry     # 服务注册管理服务
├── cloud-govern-config       # 配置中心管理服务
├── cloud-govern-monitor      # 服务监控服务
└── cloud-govern-ui           # 前端应用
```

### 模块详情

#### 1. cloud-govern-auth（认证授权服务）

| 属性 | 说明 |
|------|------|
| 输入 | 用户名、密码、验证码 |
| 输出 | JWT Token、用户信息、权限列表 |
| 核心逻辑 | 用户登录验证 → 生成 JWT → 加载权限 → 返回 Token |

#### 2. cloud-govern-system（系统管理服务）

| 属性 | 说明 |
|------|------|
| 输入 | 用户/角色/菜单 CRUD 请求 |
| 输出 | 操作结果、数据列表 |
| 核心逻辑 | 用户管理、角色管理、菜单管理、审计日志记录 |

#### 3. cloud-govern-registry（服务注册管理服务）

| 属性 | 说明 |
|------|------|
| 输入 | Nacos API 调用请求 |
| 输出 | 服务列表、实例详情、操作结果 |
| 核心逻辑 | 对接 Nacos Open API → 服务查询 → 实例管理 → 健康检查 |

#### 4. cloud-govern-config（配置中心管理服务）

| 属性 | 说明 |
|------|------|
| 输入 | 配置 CRUD 请求 |
| 输出 | 配置内容、历史版本、操作结果 |
| 核心逻辑 | 对接 Nacos Config API → 配置管理 → 版本控制 → 配置推送 |

#### 5. cloud-govern-monitor（服务监控服务）

| 属性 | 说明 |
|------|------|
| 输入 | 监控指标查询请求 |
| 输出 | 指标数据、告警信息 |
| 核心逻辑 | 采集服务指标 → 存储时序数据 → 告警规则匹配 → 通知推送 |

#### 6. cloud-govern-ui（前端应用）

| 属性 | 说明 |
|------|------|
| 输入 | 用户交互操作 |
| 输出 | 页面渲染、数据展示 |
| 核心逻辑 | 路由管理 → 权限控制 → API 调用 → 状态管理 → 页面渲染 |

### 典型用户场景

**场景1：运维人员查看服务状态**
1. 登录系统 → 进入服务管理页面
2. 查看所有注册服务的健康状态
3. 点击某个服务查看实例详情
4. 对异常实例进行下线操作

**场景2：开发人员修改配置**
1. 登录系统 → 进入配置中心
2. 选择命名空间 → 找到目标配置
3. 编辑配置内容 → 提交变更
4. 查看配置历史 → 必要时回滚

---

## 五、技术方向与关键决策（Technical Direction & Decisions）

### 技术栈总览

```
┌─────────────────────────────────────────────────────────────┐
│                      技术架构图                              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                    前端层                            │   │
│  │  Vue 3 + TypeScript + TDesign + Pinia + Vite       │   │
│  └─────────────────────────────────────────────────────┘   │
│                            │ HTTP/WebSocket                │
│                            ▼                               │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                    网关层                            │   │
│  │           Spring Cloud Gateway + JWT 验证           │   │
│  └─────────────────────────────────────────────────────┘   │
│                            │                               │
│                            ▼                               │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                    服务层                            │   │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐            │   │
│  │  │   Auth   │ │  System  │ │ Registry │            │   │
│  │  │   认证   │ │   系统   │ │  注册    │            │   │
│  │  └──────────┘ └──────────┘ └──────────┘            │   │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐            │   │
│  │  │  Config  │ │ Monitor  │ │ Gateway  │            │   │
│  │  │   配置   │ │   监控   │ │   网关   │            │   │
│  │  └──────────┘ └──────────┘ └──────────┘            │   │
│  └─────────────────────────────────────────────────────┘   │
│                            │                               │
│                            ▼                               │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                  基础设施层                          │   │
│  │  Nacos + MySQL + Redis + Sentinel                  │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 详细技术选型

| 层级 | 技术 | 版本 | 说明 |
|------|------|------|------|
| **前端** | Vue 3 | 3.4+ | 渐进式 JavaScript 框架 |
| | TypeScript | 5.0+ | 类型安全 |
| | TDesign | 1.0+ | 腾讯开源企业级设计系统 |
| | Pinia | 2.1+ | 状态管理 |
| | Vue Router | 4.2+ | 路由管理 |
| | Vite | 5.0+ | 构建工具 |
| | Axios | 1.6+ | HTTP 客户端 |
| **后端** | Spring Boot | 3.2+ | 基础框架 |
| | Spring Cloud | 2023.x | 微服务框架 |
| | Spring Cloud Alibaba | 2023.x | 阿里巴巴微服务套件 |
| | Nacos | 2.3+ | 服务注册与配置中心 |
| | Sentinel | 1.8+ | 流量控制与熔断 |
| | Spring Cloud Gateway | 4.1+ | API 网关 |
| | MyBatis-Plus | 3.5+ | ORM 框架 |
| | Sa-Token | 1.37+ | 权限认证框架 |
| **数据存储** | MySQL | 8.0+ | 关系型数据库 |
| | Redis | 7.0+ | 缓存与会话存储 |
| | Prometheus | 2.45+ | 指标采集（可选） |
| **部署** | Docker | 24+ | 容器化 |
| | Docker Compose | 2.20+ | 容器编排 |

### 已做技术决策

1. **认证方案**：采用 Sa-Token + JWT，轻量且功能完整
2. **网关方案**：Spring Cloud Gateway，与 Spring Cloud 生态无缝集成
3. **UI 组件库**：TDesign，企业级设计系统，组件丰富
4. **ORM 框架**：MyBatis-Plus，简化 CRUD 操作
5. **部署方案**：MVP 阶段使用 Docker Compose，暂不引入 K8s

### 可替代方案（备选）

| 当前选择 | 备选方案 | 选择理由 |
|----------|----------|----------|
| Sa-Token | Spring Security | Sa-Token 更轻量，API 更友好 |
| TDesign | Element Plus | TDesign 设计更现代，企业级特性更完善 |
| MyBatis-Plus | JPA/Hibernate | MyBatis-Plus 灵活性更高，国内生态更好 |
| Docker Compose | Kubernetes | MVP 阶段简单优先，后续可迁移 |

---

## 六、交互、风格与输出约定（Interaction & Style Conventions）

### AI 输出风格
- 结构清晰、层级明确、工程化表达
- 代码注释使用中文，变量命名使用英文
- 遵循阿里巴巴 Java 开发规范 + Vue 官方风格指南

### 表达规范
- 统一使用 Markdown 格式
- 必要时使用伪代码或流程图
- 架构图使用 Mermaid 语法

### 代码规范
- Java：遵循阿里巴巴 Java 开发规范
- Vue：遵循 Vue 官方风格指南
- 提交信息：遵循 Conventional Commits

### 用户特殊偏好
- 优先使用 Spring Cloud 技术栈
- 前端使用 Vue 3 + TDesign
- 保持代码简洁，避免过度设计

---

## 七、当前进展总结（Current Status）

### 已确认事实
- [x] 项目定位：轻量级微服务治理平台
- [x] 目标用户：前期学习，后期开源
- [x] 核心功能：服务注册、配置中心、服务监控、用户管理、API 网关管理
- [x] 技术栈：Spring Cloud Alibaba + Vue 3 + TDesign
- [x] 项目名称：cloud-govern

### 未解决问题
- [ ] 是否需要支持多租户？
- [ ] 告警通知方式（邮件/钉钉/企微）？
- [ ] 是否需要对接现有 Nacos/Sentinel 还是内置？

---

## 八、后续计划与风险（Next Steps & Risks）

### 待讨论主题
1. 多租户支持策略
2. 告警通知渠道选择
3. Nacos/Sentinel 集成方式
4. 前端部署方式（独立部署还是集成到网关）

### 潜在风险与不确定性

| 风险 | 等级 | 缓解措施 |
|------|------|----------|
| Nacos API 变更兼容性 | 中 | 封装适配层，隔离 API 变化 |
| 前后端联调复杂度 | 中 | 先定义 API 契约，并行开发 |
| 权限模型设计复杂度 | 低 | 参考 RBAC 标准模型 |
| 开源合规性 | 低 | 使用 MIT 协议，注意依赖许可 |

### 推荐的后续初始化 Prompt
```
阅读 memory-bank 目录下的所有文档，确认实施计划是否清晰。
如有疑问请提问，确认后开始执行实施计划的第一步。
```

---

## 九、文档索引

| 文档 | 路径 | 说明 |
|------|------|------|
| 项目上下文 | memory-bank/project-context.md | 本文档 |
| 技术选型 | memory-bank/tech-stack.md | 详细技术选型说明 |
| 实施计划 | memory-bank/implementation-plan.md | 分步实施计划 |
| 架构设计 | memory-bank/architecture.md | 系统架构设计 |
| 进度记录 | memory-bank/progress.md | 开发进度跟踪 |

---

**文档维护者**: AI Assistant
**最后更新**: 2026-02-13
